{% extends base.html %}

{% block body %}

    <nav class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="">Tornado room: {{ channel }}, hello {{ user }}</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/logout">Logout</a></li>
            <li><a href="/channels">Leave room</a></l
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
        <div class="starter-template">
            <table class="table table-striped">
              <thead>
                <tr>
                  <td><b>From:</b></td>
                  <td><b>Messages:</b></td>
                  <td><b>Date:</b></td>
                </tr>
              </thead>
              <tbody>
              {% for message in messages %}
                  <tr>
                    <td class="col-md-4"><b>{{ message['user_name'] }}</b></td>
                    <td class="col-md-8">{{ message['message'] }}</td></td>
                    <td class="col-md-8">{{ message['date'] }}</td></td>
                  </tr>
              {% end %}
              </tbody>
            </table>
            <form id="msg_form" style="float:center">
              <div id="message_form_error_id" class="form-group has-error">
                <label class="control-label" for="inputError1">Input error, Please write more than 4 characters</label>
              </div>
              <div id="message_form_id" class="form-group">
                <div class="col-sm-5">
                  <input type="text" class="form-control" name="msg" placeholder="Your message..." required>
                </div>
                <button type="submit" class="btn btn-default">Send</button>
              </div>
            </form>
        </div>
    </div>

{% end %}

{% block scripts %}
<script type="text/javascript">
  $(document).ready(function() {
    $("#message_form_error_id").hide()
    $('#msg_form').submit(function(){
        $message = $("input[name='msg']")
        room = window.location.href.split('/')[4];
        var msg = $message.val()
        if (msg.length < 4) {
            $("#message_form_id").addClass( "has-error" );
        }
        else{
            $message.val('');

            var msg = {
              msg: msg,
              room: room
            };

            var str = JSON.stringify(msg);
            console.log(str)
            ws.send(str);
            return false;
        }
    });
});
</script>

{% end %}